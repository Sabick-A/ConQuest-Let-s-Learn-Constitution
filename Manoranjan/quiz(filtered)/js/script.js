const STORE = {
  questions: {
      Sovereignty_and_Independence: [
          {
              question: "What does it mean for India to be a sovereign nation?",
              code: ``,
              answers: [
                  "India makes its own laws without interference from other countries",
                  "India is dependent on other nations for governance",
                  "India's laws are controlled by a global council",
                  "India must consult other nations before passing laws"
              ],
              correctAnswer: "India makes its own laws without interference from other countries"
          },
          {
              question: "How does India exercise its sovereignty?",
              code: ``,
              answers: [
                  "By being self-governed without any external control",
                  "By consulting other nations for major decisions",
                  "By seeking approval from international councils",
                  "By being part of a global governance system"
              ],
              correctAnswer: "By being self-governed without any external control"
          },
          {
              question: "Why is sovereignty important for India?",
              code: ``,
              answers: [
                  "It allows India to make independent decisions",
                  "It binds India to international treaties",
                  "It limits India's power within the region",
                  "It makes India reliant on other nations"
              ],
              correctAnswer: "It allows India to make independent decisions"
          }
      ],

      Socialist_Values: [
          {
              question: "What is meant by socialist values in the Indian Preamble?",
              code: ``,
              answers: [
                  "Ensuring wealth is shared fairly among citizens",
                  "Promoting private wealth accumulation",
                  "Supporting only certain privileged groups",
                  "Allowing unrestricted market competition"
              ],
              correctAnswer: "Ensuring wealth is shared fairly among citizens"
          },
          {
              question: "How does India promote socialist values?",
              code: ``,
              answers: [
                  "By ensuring equal access to resources and opportunities",
                  "By allowing individuals to accumulate wealth freely",
                  "By promoting private businesses over public welfare",
                  "By encouraging unequal wealth distribution"
              ],
              correctAnswer: "By ensuring equal access to resources and opportunities"
          },
          {
              question: "Which of the following is a key element of India's socialist values?",
              code: ``,
              answers: [
                  "Promoting social equality and reducing wealth disparity",
                  "Focusing solely on economic growth",
                  "Prioritizing individual wealth over collective welfare",
                  "Reducing government intervention in the economy"
              ],
              correctAnswer: "Promoting social equality and reducing wealth disparity"
          }
      ],

      Secularism: [
          {
              question: "What does the term 'secular nation' signify in India's Preamble?",
              code: ``,
              answers: [
                  "All religions are treated equally, with no special treatment",
                  "The government endorses one particular religion",
                  "Religious practices are banned",
                  "Only major religions are allowed"
              ],
              correctAnswer: "All religions are treated equally, with no special treatment"
          },
          {
              question: "How does secularism manifest in Indian governance?",
              code: ``,
              answers: [
                  "The government remains neutral in religious matters",
                  "The government favors a specific religion",
                  "Religious laws override constitutional laws",
                  "The government discourages all religious activities"
              ],
              correctAnswer: "The government remains neutral in religious matters"
          },
          {
              question: "Why is secularism important in a diverse country like India?",
              code: ``,
              answers: [
                  "It ensures equality among all religious groups",
                  "It promotes a single dominant religion",
                  "It limits religious freedom",
                  "It enforces religious practices on citizens"
              ],
              correctAnswer: "It ensures equality among all religious groups"
          }
      ],

      Democracy_and_Political_System: [
          {
              question: "What is the significance of democracy in India’s political system?",
              code: ``,
              answers: [
                  "Citizens elect leaders who represent them in government",
                  "The government is chosen by military officials",
                  "Only certain people are allowed to vote",
                  "Leadership is inherited through family lines"
              ],
              correctAnswer: "Citizens elect leaders who represent them in government"
          },
          {
              question: "How do citizens participate in India's democracy?",
              code: ``,
              answers: [
                  "By voting in elections to choose their representatives",
                  "By relying on the government to make all decisions",
                  "By avoiding any political involvement",
                  "By inheriting political positions"
              ],
              correctAnswer: "By voting in elections to choose their representatives"
          },
          {
              question: "What role do elections play in India's democracy?",
              code: ``,
              answers: [
                  "They allow citizens to choose their leaders",
                  "They are symbolic with no real significance",
                  "They are held only when the government decides",
                  "They are used to confirm the appointment of officials"
              ],
              correctAnswer: "They allow citizens to choose their leaders"
          }
      ],

      Justice_Liberty_Equality: [
          {
              question: "What are the core values mentioned in the Preamble of the Indian Constitution?",
              code: ``,
              answers: [
                  "Justice, Liberty, and Equality",
                  "Power, Wealth, and Privilege",
                  "Authority, Status, and Control",
                  "Wealth, Influence, and Politics"
              ],
              correctAnswer: "Justice, Liberty, and Equality"
          },
          {
              question: "How is justice ensured under the Indian Constitution?",
              code: ``,
              answers: [
                  "Through a fair and impartial legal system",
                  "By allowing individuals to create their own laws",
                  "By ignoring any legal disputes",
                  "By making laws based on personal preferences"
              ],
              correctAnswer: "Through a fair and impartial legal system"
          },
          {
              question: "Why is liberty an important value in India's Constitution?",
              code: ``,
              answers: [
                  "It allows individuals to express themselves freely",
                  "It limits individual freedoms to a great extent",
                  "It gives the government complete control",
                  "It focuses solely on economic liberty"
              ],
              correctAnswer: "It allows individuals to express themselves freely"
          }
      ],

      Respect_for_Constitution: [
          {
              question: "What is one of the fundamental duties of an Indian citizen regarding the Constitution?",
              code: ``,
              answers: [
                  "To respect and follow the principles of the Constitution",
                  "To ignore the rules of the Constitution",
                  "To criticize the national governance system",
                  "To rewrite the Constitution regularly"
              ],
              correctAnswer: "To respect and follow the principles of the Constitution"
          },
          {
              question: "How can citizens show respect for the Indian Constitution?",
              code: ``,
              answers: [
                  "By following its laws and principles",
                  "By disregarding constitutional guidelines",
                  "By challenging every constitutional law",
                  "By avoiding any participation in governance"
              ],
              correctAnswer: "By following its laws and principles"
          },
          {
              question: "Why is it important to follow the Constitution?",
              code: ``,
              answers: [
                  "It ensures a well-organized and fair society",
                  "It limits the rights of citizens",
                  "It only applies to government officials",
                  "It prevents citizens from participating in governance"
              ],
              correctAnswer: "It ensures a well-organized and fair society"
          }
      ],

      Respect_for_National_Symbols: [
          {
              question: "What is the duty of citizens concerning national symbols like the National Flag and Anthem?",
              code: ``,
              answers: [
                  "To respect and honor them",
                  "To create new national symbols",
                  "To ignore their significance",
                  "To modify them as needed"
              ],
              correctAnswer: "To respect and honor them"
          },
          {
              question: "How can citizens show respect for the National Flag?",
              code: ``,
              answers: [
                  "By handling it with care and not disrespecting it",
                  "By altering its design",
                  "By ignoring its presence",
                  "By using it for personal purposes"
              ],
              correctAnswer: "By handling it with care and not disrespecting it"
          },
          {
              question: "Why is it important to show respect for national symbols?",
              code: ``,
              answers: [
                  "They represent the nation’s identity and unity",
                  "They are purely decorative",
                  "They have no real significance",
                  "They are used for commercial purposes"
              ],
              correctAnswer: "They represent the nation’s identity and unity"
          }
      ],

      Environmental_Protection: [
          {
              question: "What is the duty of Indian citizens regarding the environment?",
              code: ``,
              answers: [
                  "To protect forests, rivers, and wildlife",
                  "To exploit natural resources for profit",
                  "To ignore environmental concerns",
                  "To harm nature as they see fit"
              ],
              correctAnswer: "To protect forests, rivers, and wildlife"
          },
          {
              question: "How can citizens contribute to protecting nature?",
              code: ``,
              answers: [
                  "By reducing waste and conserving resources",
                  "By polluting natural resources",
                  "By ignoring environmental issues",
                  "By cutting down trees indiscriminately"
              ],
              correctAnswer: "By reducing waste and conserving resources"
          },
          {
              question: "Why is it important for citizens to protect the environment?",
              code: ``,
              answers: [
                  "It ensures a healthy ecosystem for future generations",
                  "It is not a citizen's responsibility",
                  "It only benefits the government",
                  "It leads to personal profit"
              ],
              correctAnswer: "It ensures a healthy ecosystem for future generations"
          }
      ],

      Scientific_Temper_and_Education: [
          {
              question: "What does developing scientific temper mean for Indian citizens?",
              code: ``,
              answers: [
                  "Being curious and thinking logically to solve problems",
                  "Relying solely on traditional beliefs",
                  "Ignoring scientific advancements",
                  "Avoiding critical thinking"
              ],
              correctAnswer: "Being curious and thinking logically to solve problems"
          },
          {
              question: "Why is it important to develop a scientific temper?",
              code: ``,
              answers: [
                  "It promotes progress and problem-solving in society",
                  "It discourages innovation",
                  "It focuses only on theoretical knowledge",
                  "It limits curiosity and exploration"
              ],
              correctAnswer: "It promotes progress and problem-solving in society"
          },
          {
              question: "What duty do parents have regarding education?",
              code: ``,
              answers: [
                  "Ensuring their children aged 6 to 14 receive an education",
                  "Avoiding their children's education",
                  "Discouraging school attendance",
                  "Relying solely on informal learning"
              ],
              correctAnswer: "Ensuring their children aged 6 to 14 receive an education"
          }
      ],

      National_Service_and_Harmony: [
          {
              question: "What is the duty of Indian citizens regarding national service?",
              code: ``,
              answers: [
                  "To defend and serve the country during emergencies",
                  "To avoid national responsibilities",
                  "To rely on others for national defence",
                  "To prioritize personal interests over national service"
              ],
              correctAnswer: "To defend and serve the country during emergencies"
          },
          {
              question: "How can citizens promote harmony in society?",
              code: ``,
              answers: [
                  "By spreading peace and unity among all communities",
                  "By creating divisions based on religion or language",
                  "By promoting conflict and misunderstandings",
                  "By ignoring social issues"
              ],
              correctAnswer: "By spreading peace and unity among all communities"
          },
          {
              question: "Why is promoting harmony important for India's diverse society?",
              code: ``,
              answers: [
                  "It strengthens national unity and reduces conflicts",
                  "It leads to division and instability",
                  "It only benefits certain communities",
                  "It encourages violence and unrest"
              ],
              correctAnswer: "It strengthens national unity and reduces conflicts"
          }
      ]
  }
}

   

// Make the quiz. Create a model for our app's state
function makeQuiz(){
	// Creating an object to store the app's state when beginning the quiz
	return {
		// Gathering a random question out of the available questions for each category
		questions: helpers.getRandomQuestions(STORE),
		// Boolean for if the quiz is in progress or not
		midQuiz: false,
		// Array of correct/incorrect answers to use for our progress bar
		progress: {
			progressBar: [],
			incorrectCategories: []
		},
		// Boolean to determine if the end state should display
		completed: false,
		// Monitoring which question we are currently on
		currentQuestion: 0,
		// Keeps track of total correct answers
		correctAnswers: 0,
		// Keeps current selected answer
		currentAnswer: "",
		// Keeps track of % completed
		percCorrect: 0
	}
}

// Apply fadeOut animations and set the stage for DOM text/element changes
function $fade(appState){

	// This is the completed state of of a quiz
	if(appState.completed){
		
		// Fade out elements with a promise to avoid choppy behavior
		$.when($('.question-answer-wrapper, .question-wrapper, .answer-wrapper').fadeOut(500))
			.done(function(){

				// Display results of the quiz
				$showResults(appState);
				$('.results-wrapper').hide().removeClass('hide');
				$('.question-answer-wrapper, .results-wrapper').fadeIn(500);
	    });

	// This is if the app is just starting
	} else if(appState.midQuiz === false){

		// Set a flag that the app has begun
		appState.midQuiz = true;
		// Fade out elements with a promise to avoid choppy behavior
		$.when($('.question-answer-wrapper, .question-wrapper, .code, .answer-wrapper, .start-quiz, .quit-quiz, .results-wrapper, .progress, .progress-bar').fadeOut(500))
			.done(function(){
				// Remove any progress from a previous quiz (if any);
				helpers.updateProgressBar(appState);
				$('.progress-count').html('1 / 10');
				$('.progress-perc').html('');
				// Kill previous results
				$('.failures').remove();
				// Lots to do... mostly just setting up a new environment for a new quiz
				$updateQuestion(appState);
				$('progress-bar').empty();
				$('progress-fill').html('Progress: <span class="progress-count">1 / 10</span><span class="progress-perc"></span>');
				$('.question-answer-wrapper, .answer-wrapper').removeClass('begin');
				$('.submit-btn, .progress, .progress-bar').removeClass('hide');
				$('.progress, .progress-bar').hide();
				$('.question-answer-wrapper, .question-wrapper, .answer-wrapper, .progress, .progress-bar').fadeIn(500);
				if(!$('.code').hasClass('hide')){$('.code').fadeIn(500)};
	    });

	// This is if the app is in the middle of execution
	} else if(appState.midQuiz){
		$.when($('.question-answer-wrapper, .question-wrapper, .answer-wrapper').fadeOut(500))
			.done(function(){
				$updateQuestion(appState);
				$('.question-answer-wrapper, .question-wrapper, .answer-wrapper').fadeIn(500);
	    });
	}
}

// Work in progress...
function $showResults(appState){
  let endMsg = '';
  let endFeedback = '';
	if(appState.correctAnswers === 10){
		endMsg = `You got ${appState.percCorrect}% correct!
I have nothing else to teach you. Move on and prosper!
`;
	} else {
		$('.answer-btn').remove();
    if(appState.correctAnswers >=7){
		  endMsg = `You got ${appState.percCorrect}% correct!`
		  endFeedback = `You are now eligible to move to the next level`;
    }
    else
    {
      endMsg = `You got ${appState.percCorrect}% correct!`
		   endFeedback = `Sorry try harder to score at least 7 to move to next Level`;
    }
		if(appState.progress.incorrectCategories.length === 0){
			endFeedback = `You aced it! Good job!`;
		} else {
			endFeedback = `You may want to study up on the following categories:`;
		}
		
		$('.quiz-end-score').html(endMsg);
		let $failList = $('<ul class="failures"></ul>');
		appState.progress.incorrectCategories.map((cat => {
			$failList.append("<li class='category'>" + cat + "</li>");
		}));
		$('.quiz-end-feedback-p').html(endFeedback);
		$('.quiz-end-categories').append($failList);
		$('.results-wrapper').removeClass('hide').css('display', 'flex');
		$('.question-answer-wrapper, .results-wrapper, .quiz-end-feedback, .quiz-end-score, .retry-btn').css('display', 'flex').fadeIn(500);		
	}

}

// Update the question, code, answers, buttons in the DOM while we're in a faded out state
function $updateQuestion(appState){
	$('.answer-btn').remove();

	// Update the question and code text with the current question
	$('.question').html(appState.questions[appState.currentQuestion].question);

	// This is a hack to hide/show the code portion
	// Only 1/3 of the questions contain code so we hide it if they aren't present
	if(appState.questions[appState.currentQuestion].code == ``){
		$('.code').addClass('hide');
	} else {
		$('.code').removeClass('hide');
		$('.code').html(`<pre>${appState.questions[appState.currentQuestion].code}</pre>`);
	}
	
	// Change continue back to submit
	$('.continue-btn')
		.val("Submit")
		.removeClass('continue-btn')
		.addClass('submit-btn')
		.prop('disabled', true);

	// Add in available answers for the question
	let $answers = [];

	// Adding the answers to a temporary array
	for(let i=0; i<appState.questions[appState.currentQuestion].answers.length; i++){

		// Add current question answers to an array
		let $answer = $('<button class="answer-btn" type="button"></button>');
		$answer.html(appState.questions[appState.currentQuestion].answers[i]);
		$answers.push($answer);
	}

	// Shuffle the answers
	helpers.shuffleAnswers($answers)

	// Push answers to the DOM
	$answers.forEach((answer) => {
		$('.answer-wrapper').prepend(answer);
	});
}

// Simple class and enable/disable DOM selection when answer is selected
function selectAnswer(answer){
	$('.answer-btn').removeClass('selected');
	answer.addClass('selected');
	$('.submit-btn').prop('disabled', false);
}

// Answer is selected and submitted
// Push a feedback state
function submitAnswer(appState){

	// This will be returned true or false based on their answer
	let correct;

	// Add styles to the answers to show if their answer was correct or not
	$('.answer-btn').each(function () {
		if($(this).html() === appState.questions[appState.currentQuestion].correctAnswer){
			$(this).addClass('pass');
			// If answer is correct and selected...
			if($(this).hasClass('selected')){
				correct = "pass";
				appState.correctAnswers++;
				appState.questions[appState.currentQuestion];
			}

		// Handle correct answer if selected answer is incorrect
		} else if ($(this).hasClass('selected')){
			$(this).addClass('fail dim-answer');
			correct = "fail";
			appState.progress.incorrectCategories.push(appState.questions[appState.currentQuestion].category);

		// Dim the other answers to make the correct one more prevalent
		} else {
			$(this).addClass('dim-answer');
		}
	});

	// Add a progress bar indicator to our appState object
	appState.progress.progressBar.push(`<div class="progress-indicator ${correct}"></div>`);
	
	// Update our percent correct (parse a float and set it to a fixed percentage)
	appState.percCorrect = parseFloat(appState.correctAnswers / (appState.currentQuestion + 1) * 100).toFixed();

	// Update our current question VS total quiz length
	$('.progress-count').html(`
		${appState.currentQuestion + 1} / ${appState.questions.length}
	`);

	// Update our current correct percentage
	$('.progress-perc').html(`
		 // ${(appState.percCorrect)}% Correct
	`)

	// Change submit back to continue
	$('.submit-btn')
		.val("Continue")
		.removeClass('submit-btn')
		.addClass('continue-btn')

	// Disable selecting answers
	$('.answer-btn').prop("disabled", true);

	// Update our progress-bar DOM
	helpers.updateProgressBar(appState);

	// Continue to next question
	appState.currentQuestion++;

	// Verify if we're done or not
	if(appState.currentQuestion === appState.questions.length){
		appState.completed = true;
	}
	
}

// Silly easter egg for saying you don't want to do the quiz
function killQuiz(){
	$('.start-quiz, .quit-quiz').hide();
	let failureMsg = "You didn't grow. You didn't improve. You took a shortcut and gained nothing. You experienced a hollow victory. Nothing was risked and nothing was gained. It's sad you don't know the difference..."
	let msgSplit = failureMsg.split(" ");
	let counter = 0;
	$('.question').empty();
	let startTroll = setInterval(function () {
		$('.question').append(msgSplit[counter] + " ");
		counter++;
		if(counter > msgSplit.length - 1){
  			clearInterval(startTroll);
  			$('.start-quiz').text('You can do it! Start Quiz').fadeIn(500);
		}
	}, 250);
}

// These are simple algorithms to modify data that don't need an individual function
let helpers = {
	// Pick a random question from the available ones
	pickRandomQ: function(obj,section){
		return Math.floor(Math.random() * obj.questions[section].length);		
	},
	// Gather a random question from every category
	getRandomQuestions: function(obj){
		let questions = [];
		let categories = Object.keys(obj.questions);
		categories.forEach((cat) => {
			let randomQ = this.pickRandomQ(obj,cat);
			let question = obj.questions[cat][randomQ];
			question.category = cat;
			questions.push(question);
		});
		return questions;
	},
	// Shuffle the answers so they don't appear in the same order
	shuffleAnswers: function(arr){
	    for (var i = arr.length - 1; i > 0; i--) {
	        var j = Math.floor(Math.random() * (i + 1));
	        var temp = arr[i];
	        arr[i] = arr[j];
	        arr[j] = temp;
	    }
	},
	// Update progress bar DOM element
	updateProgressBar: function(appState){
		$('.progress-bar').empty();
		appState.progress.progressBar.forEach((progInd => {
			$('.progress-bar').append(progInd);
		}))
	}
}

// Lets start the show
$(function(){

	// Kill any form refresh
	$('.answer-wrapper').on('submit', function(e){
		e.preventDefault();
	});

	// Storage for quiz app state
	let quizData;

	// Start quiz
	$('.start-quiz, .retry-btn').on('click', function(){
		quizData = makeQuiz();
		$fade(quizData);
	});

	// Select an answer
	$('.question-answer-wrapper').on('click', '.answer-btn', function(){
		selectAnswer($(this));
	})

	// Submit your answer to display feedback and advance question counter
	$('.question-answer-wrapper').on('click', '.submit-btn', function(e){
		submitAnswer(quizData);
	});

	// Submit your answer to display feedback and advance question counter
	$('.question-answer-wrapper').on('click', '.continue-btn', function(){
		$fade(quizData);
	});

	// Easter egg to chastize the user
	$('.quit-quiz').on('click', function(){
		killQuiz();
	})
})
